@page "/customer/{CustomerId:int}"
@inject IJSRuntime JSRuntime
@inject DatabaseService DatabaseService
@inject NavigationManager NavigationManager
@inject IDialogService Dialog
@inject PrintService PrintService
@using System.Globalization
@using Kuyumcu.Components.Helper

<MudContainer Class="mt-4">
    <MudPaper Elevation="0" Class="mb-4">
        <MudGrid>
            <MudItem xs="12">
                <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center">
                    <MudText Typo="Typo.h4">Müşteri İşlemleri</MudText>
                    <MudButton Variant="Variant.Outlined" Color="Color.Secondary" StartIcon="@Icons.Material.Filled.ArrowBack"
                               OnClick="GoBack">Geri Dön</MudButton>
                </MudStack>
            </MudItem>
        </MudGrid>
    </MudPaper>
</MudContainer>

@if (isLoading)
{
    <MudProgressCircular Color="Color.Primary" Indeterminate="true" Class="my-7" Size="Size.Large" />
}
else if (customer == null)
{
    <MudAlert Severity="Severity.Error">Müşteri bulunamadı!</MudAlert>
}
else
{
    <MudPaper Elevation="1" Class="pa-4 mb-4">
        <MudText Typo="Typo.h5">@customer.Name</MudText>
        <MudGrid>
            <MudItem xs="12" md="6">
                <MudText><b>Telefon:</b> @customer.PhoneNumber.FormatPhoneNumber()</MudText>
            </MudItem>
        </MudGrid>

        @if (groupedTransactions != null && groupedTransactions.Any())
        {
            <MudText Class="mt-4 mb-2"><b>Güncel Durum (Tüm Para Birimleri):</b></MudText>
            <MudGrid>
                @foreach (var group in groupedTransactions)
                {
                    <MudItem xs="12" sm="6" md="4">
                        <MudPaper Elevation="1" Class="pa-2" Style="@(group.Balance == 0 ? "" : group.Balance > 0 ? "background-color: rgba(244,67,54,0.1)" : "background-color: rgba(76,175,80,0.1)")">
                            <MudStack Row="true" Justify="Justify.SpaceBetween">
                                <MudText><b>@group.Key.GetDisplayName():</b></MudText>
                                @if (group.Balance == 0)
                                {
                                    <MudText>Hesap Sıfır</MudText>
                                }
                                else if (group.Balance > 0)
                                {
                                    <MudText Color="Color.Error">@Helper.HelperMethods.FormatPrice(group.Balance)  @group.Key.GetSymbol() (Giden)</MudText>
                                }
                                else
                                {
                                    <MudText Color="Color.Primary">@Helper.HelperMethods.FormatPrice(Math.Abs(group.Balance)) @group.Key.GetSymbol() (Gelen)</MudText>
                                }
                            </MudStack>
                        </MudPaper>
                    </MudItem>
                }
            </MudGrid>

            <!-- Emanet Özeti -->
            @if (depositTransactions != null && depositTransactions.Any())
            {
                <MudText Class="mt-4 mb-2"><b>Emanetler:</b></MudText>
                <MudGrid>
                    @foreach (var group in depositTransactions.GroupBy(t => t.CurrencyType))
                    {
                        <MudItem xs="12" sm="6" md="4">
                            <MudPaper Elevation="1" Class="pa-2" Style="background-color: rgba(158,158,158,0.1)">
                                <MudStack Row="true" Justify="Justify.SpaceBetween">
                                    <MudText><b>@group.Key.GetDisplayName():</b></MudText>
                                    <MudText>@Helper.HelperMethods.FormatPrice(group.Sum(t => t.Amount)) @group.Key.GetSymbol() (Emanet)</MudText>
                                </MudStack>
                            </MudPaper>
                        </MudItem>
                    }
                </MudGrid>
            }

            <MudStack Row="true" Justify="Justify.FlexEnd" Class="mt-3">
                <MudStack Row="true" AlignItems="AlignItems.Center">
                    <MudSelect T="string" Label="Yazıcı" @bind-Value="selectedPrinter" Variant="Variant.Outlined"
                               AnchorOrigin="Origin.BottomCenter" Style="min-width: 200px;">
                        @foreach (var printer in availablePrinters)
                        {
                            <MudSelectItem Value="@printer">@printer</MudSelectItem>
                        }
                    </MudSelect>
                    <MudButton Variant="Variant.Filled"
                               Color="Color.Primary"
                               StartIcon="@Icons.Material.Filled.Print"
                               OnClick="PrintCustomerReceipt">Yazdır</MudButton>
                </MudStack>
            </MudStack>
        }
        </MudPaper>

    <MudPaper Elevation="0" Class="mb-4">
        <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center">
            <MudText Typo="Typo.h5">İşlemler</MudText>
            <MudStack Row="true">
                <MudButton Variant="Variant.Filled" Color="Color.Error" StartIcon="@Icons.Material.Filled.Add"
                           OnClick="() => ShowTransactionModal(TransactionType.CustomerDebt)">Giden Ekle</MudButton>
                <MudButton Variant="Variant.Filled" Color="Color.Success" StartIcon="@Icons.Material.Filled.Add"
                           OnClick="() => ShowTransactionModal(TransactionType.StoreDebt)">Gelen Ekle</MudButton>
            </MudStack>
        </MudStack>
    </MudPaper>

    @if (transactions == null || transactions.Count == 0)
    {
        <MudAlert Severity="Severity.Info">Bu müşteriye ait işlem kaydı bulunmamaktadır.</MudAlert>
    }
    else
    {
        <MudGrid>
            @{
                var groupCount = 0;
            }
            @foreach (var currencyGroup in groupedTransactions)
            {
                <MudItem xs="12" md="4">
                    <MudCard Class="mud-height-full mb-4">
                        <MudCardHeader>
                            <CardHeaderContent>
                                <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center">
                                    <MudText Typo="Typo.h6">@currencyGroup.Key.GetDisplayName() (@currencyGroup.Key.GetSymbol())</MudText>
                                    <MudStack Row="true">
                                        <MudButton Size="Size.Small" Variant="Variant.Filled" Color="Color.Error"
                                                   OnClick="() => ShowTransactionModal(TransactionType.CustomerDebt, currencyGroup.Key)">Giden</MudButton>
                                        <MudButton Size="Size.Small" Variant="Variant.Filled" Color="Color.Success"
                                                   OnClick="() => ShowTransactionModal(TransactionType.StoreDebt, currencyGroup.Key)">Gelen</MudButton>
                                    </MudStack>
                                </MudStack>
                            </CardHeaderContent>
                        </MudCardHeader>
                        <MudCardContent>
                            <MudTable Items="@currencyGroup.Transactions" Hover="true" Breakpoint="Breakpoint.Sm">
                                <HeaderContent>
                                    <MudTh>Tarih</MudTh>
                                    <MudTh>Tür</MudTh>
                                    <MudTh>Tutar</MudTh>
                                    <MudTh>İşlemler</MudTh>
                                </HeaderContent>
                                <RowTemplate>
                                    <MudTd DataLabel="Tarih">
                                        @context.Date.ToString("dd.MM.yyyy HH:mm")
                                   
                                    </MudTd>
                                    <MudTd DataLabel="Tür">
                                        @if (context.Type == TransactionType.CustomerDebt)
                                        {
                                            <MudChip T="string" Color="Color.Error" Size="Size.Small">Giden</MudChip>
                                        }
                                        else
                                        {
                                            <MudChip T="string" Color="Color.Success" Size="Size.Small">Gelen</MudChip>
                                        }
                                    </MudTd>
                                    <MudTd DataLabel="Tutar">@Helper.HelperMethods.FormatPrice(context.Amount) @context.CurrencyType.GetSymbol()</MudTd>
                                    <MudTd DataLabel="İşlemler">
                                        <MudStack Row="true" Spacing="0">
                                            <MudIconButton Icon="@Icons.Material.Filled.Edit" Color="Color.Warning" Size="Size.Small"
                                                           OnClick="() => EditTransaction(context)" />
                                            <MudIconButton Icon="@Icons.Material.Filled.Delete" Color="Color.Error" Size="Size.Small"
                                                           OnClick="() => DeleteTransaction(context)" />
                                            @if (!string.IsNullOrWhiteSpace(context.Description))
                                            {
                                                <MudIconButton Icon="@Icons.Material.Filled.Visibility" Size="Size.Small" Color="Color.Info"
                                                               OnClick="@(() => ShowTransactionDescription(context))" />
                                            }
                                        </MudStack>
                                    </MudTd>
                                </RowTemplate>
                            </MudTable>

                            <MudAlert Severity="@(currencyGroup.Balance == 0 ? Severity.Normal : currencyGroup.Balance < 0 ? Severity.Success : Severity.Error)"
                                      Class="mt-3">
                                <MudText>
                                    <b>Kalan: </b>
                                    @if (currencyGroup.Balance == 0)
                                    {
                                        <span>Hesap Sıfır</span>
                                    }
                                    else if (currencyGroup.Balance > 0)
                                    {
                                        <span>@Helper.HelperMethods.FormatPrice(currencyGroup.Balance) @(currencyGroup.Key > CurrencyType.Riyal ? currencyGroup.Key.GetSymbol() + " " + currencyGroup.Key.GetDisplayName() : " " + currencyGroup.Key.GetDisplayName()) (Giden)</span>
                                    }
                                    else if (currencyGroup.Balance < 0)
                                    {
                                        <span>@Helper.HelperMethods.FormatPrice(Math.Abs(currencyGroup.Balance)) @(currencyGroup.Key > CurrencyType.Riyal ? currencyGroup.Key.GetSymbol() + " " + currencyGroup.Key.GetDisplayName() : " " + currencyGroup.Key.GetDisplayName()) (Gelen)</span>
                                    }
                                </MudText>
                            </MudAlert>
                        </MudCardContent>
                    </MudCard>
                </MudItem>
            }
            </MudGrid>
    }

    <!-- Emanet İşlemler -->
    @if (depositTransactions != null && depositTransactions.Any())
    {
        <MudPaper Elevation="1" Class="mb-4">
            <MudCardHeader>
                <CardHeaderContent>
                    <MudText Typo="Typo.h5">Emanet İşlemler</MudText>
                </CardHeaderContent>
            </MudCardHeader>
            <MudCardContent>
                <MudTable Items="@depositTransactions" Hover="true" Breakpoint="Breakpoint.Sm">
                    <HeaderContent>
                        <MudTh>Tarih</MudTh>
                        <MudTh>Tutar</MudTh>
                        <MudTh>Para Birimi</MudTh>
                        <MudTh>Açıklama</MudTh>
                        <MudTh>İşlemler</MudTh>
                    </HeaderContent>
                    <RowTemplate>
                        <MudTd DataLabel="Tarih">
                            @context.Date.ToString("dd.MM.yyyy HH:mm")
                          
                        </MudTd>
                        <MudTd DataLabel="Tutar">@Helper.HelperMethods.FormatPrice(context.Amount)</MudTd>
                        <MudTd DataLabel="Para Birimi">@context.CurrencyType.GetDisplayName() (@context.CurrencyType.GetSymbol())</MudTd>
                        <MudTd DataLabel="Açıklama">@context.Description</MudTd>
                        <MudTd DataLabel="İşlemler">
                            <MudStack Row="true" Spacing="0">
                                <MudIconButton Icon="@Icons.Material.Filled.Edit" Color="Color.Warning" Size="Size.Small"
                                               OnClick="() => EditTransaction(context)" />
                                <MudIconButton Icon="@Icons.Material.Filled.Delete" Color="Color.Error" Size="Size.Small"
                                               OnClick="() => DeleteTransaction(context)" />
                                @if (!string.IsNullOrWhiteSpace(context.Description))
                                {
                                    <MudIconButton Icon="@Icons.Material.Filled.Visibility" Size="Size.Small" Color="Color.Info"
                                                   OnClick="@(() => ShowTransactionDescription(context))" />
                                }
                            </MudStack>
                        </MudTd>
                    </RowTemplate>
                </MudTable>
            </MudCardContent>
        </MudPaper>
    }
}

<MudDialog @bind-Visible="showTransactionModal" Options="_dialogOptions">
    <DialogContent>
        <MudContainer Style="max-height: 500px; overflow-y: auto">
            <MudText Typo="Typo.h6" Class="mb-4">
                @if (currentTransaction.Id == 0)
                {
                    @(currentTransaction.Type == TransactionType.CustomerDebt ? "Yeni Giden" : "Yeni Gelen")
                }
                else
                {
                    @("İşlemi Düzenle")
                }
            </MudText>
            <EditForm Model="currentTransaction" OnValidSubmit="SaveTransaction">
                <DataAnnotationsValidator />

                @if (currentTransaction.Id != 0)
                {
                    <MudSelect T="TransactionType" Label="İşlem Türü" @bind-Value="currentTransaction.Type" Variant="Variant.Outlined" Class="mb-3">
                        <MudSelectItem T="TransactionType" Value="@(TransactionType.CustomerDebt)">Giden</MudSelectItem>
                        <MudSelectItem T="TransactionType" Value="@(TransactionType.StoreDebt)">Gelen</MudSelectItem>
                    </MudSelect>
                }
                <MudStack Class="pa-4" Spacing="2">
                    <MudGrid>
                        <MudItem xs="12" sm="6">
                            <MudTextField T="decimal" Label="Tutar" @bind-Value="currentTransaction.Amount"
                                          id="amountInput" @onfocus="SelectInputTextAsync"
                                          Variant="Variant.Outlined" Required="true"
                                          RequiredError="Tutar gereklidir" Immediate
                                          HelperText="@Helper.HelperMethods.FormatPrice(currentTransaction.Amount)"
                                          For="@(() => currentTransaction.Amount)"
                                          Class="mb-3" />
                        </MudItem>
                        <MudItem xs="12" sm="6">
                            <MudSelect T="CurrencyType" Label="Para Birimi" @bind-Value="currentTransaction.CurrencyType" Variant="Variant.Outlined" Class="mb-3">
                                <MudSelectItem T="CurrencyType" Value="@(CurrencyType.TurkishLira)">Türk Lirası</MudSelectItem>
                                <MudSelectItem T="CurrencyType" Value="@(CurrencyType.Dollar)">Dolar</MudSelectItem>
                                <MudSelectItem T="CurrencyType" Value="@(CurrencyType.Euro)">Euro</MudSelectItem>
                                <MudSelectItem T="CurrencyType" Value="@(CurrencyType.Riyal)">Riyal</MudSelectItem>
                                <MudSelectItem T="CurrencyType" Value="@(CurrencyType.Sterlin)">Sterlin</MudSelectItem>
                                <MudSelectItem T="CurrencyType" Value="@(CurrencyType.FullGold)">Tam Altın</MudSelectItem>
                                <MudSelectItem T="CurrencyType" Value="@(CurrencyType.HalfGold)">Yarım Altın</MudSelectItem>
                                <MudSelectItem T="CurrencyType" Value="@(CurrencyType.QuarterGold)">Çeyrek Altın</MudSelectItem>
                                <MudSelectItem T="CurrencyType" Value="@(CurrencyType.Ziynet)">Ziynet Altın</MudSelectItem>
                                <MudSelectItem T="CurrencyType" Value="@(CurrencyType.Gold24K)">24 Ayar Gram</MudSelectItem>
                                <MudSelectItem T="CurrencyType" Value="@(CurrencyType.Gold22K)">22 Ayar Gram</MudSelectItem>
                                <MudSelectItem T="CurrencyType" Value="@(CurrencyType.Gold14K)">14 Ayar Gram</MudSelectItem>
                            </MudSelect>
                        </MudItem>
                    </MudGrid>
                    <MudGrid>
                        <MudItem xs="12" sm="6">
                            <MudDatePicker Label="dd.MM.yyyy" OpenTo="OpenTo.Year" PickerVariant="PickerVariant.Dialog" Editable="true" Class="mb-3" @bind-Date="currentTransactionDate" Mask="@(new DateMask("dd.MM.yyyy"))" DateFormat="dd.MM.yyyy" Placeholder="dd.MM.yyyy" Variant="Variant.Outlined" />

                        </MudItem>
                        <MudItem xs="12" sm="6">
                            <MudTimePicker Label="Saat" @bind-Time="currentTransactionTime" PickerVariant="PickerVariant.Dialog" Variant="Variant.Outlined" Class="mb-3" Editable />
                        </MudItem>
                    </MudGrid>
                </MudStack>
                @if (currentTransaction.Type == TransactionType.StoreDebt)
                {
                    <MudCheckBox @bind-Value="currentTransaction.IsDeposit" Label="Emanet" Color="Color.Primary" Class="mb-3"></MudCheckBox>

                }
                <MudTextField T="string" Label="Açıklama (Opsiyonel)" @bind-Value="currentTransaction.Description"
                              Variant="Variant.Outlined" Lines="3" Class="mb-3" />

                <MudDivider Class="my-4" />
                <MudStack Row="true" Justify="Justify.FlexEnd">
                    <MudButton Variant="Variant.Text" Color="Color.Default" OnClick="CloseTransactionModal">İptal</MudButton>
                    <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary">Kaydet</MudButton>
                </MudStack>
            </EditForm>
        </MudContainer>
    </DialogContent>
</MudDialog>

@code {

    [Parameter]
    public int CustomerId { get; set; }
    [CascadingParameter]
    private IMudDialogInstance MudDialog { get; set; }

    private readonly DialogOptions _dialogOptions = new() { NoHeader = true, MaxWidth = MaxWidth.Small, FullWidth = true };

    private void OpenDialog() => showTransactionModal = true;

    private void Submit() => showTransactionModal = false;
    private Customer customer;
    private List<Transaction> transactions;
    private List<Transaction> depositTransactions;
    private List<TransactionGroup> groupedTransactions;
    private bool isLoading = true;

    private bool showTransactionModal = false;
    private Transaction currentTransaction = new Transaction();
    private DateTime? currentTransactionDate;
    private TimeSpan? currentTransactionTime;

    // Printer selection
    private List<string> availablePrinters = new List<string>();
    private string selectedPrinter;

    protected override async Task OnInitializedAsync()
    {
        // Yazıcıları yükle
        LoadPrinters();

        await LoadCustomerData();
    }


    private void LoadPrinters()
    {
        try
        {
            availablePrinters = PrintService.GetAvailablePrinters();

            // Eğer yazıcı varsa, ilk yazıcıyı seç
            if (availablePrinters.Count > 0)
            {
                selectedPrinter = availablePrinters.FirstOrDefault(p => p.ToLower().Contains("thermal") || p.ToLower().Contains("termal"));

                // Termal yazıcı bulunamadıysa ilk yazıcıyı seç
                if (string.IsNullOrEmpty(selectedPrinter))
                {
                    selectedPrinter = availablePrinters[0];
                }
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Yazıcı listesi alınamadı: {ex.Message}");
        }
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await JSRuntime.InvokeVoidAsync("eval", @"
                window.selectInputText = function(id) {
                    var element = document.getElementById(id);
                    if (element) {
                        setTimeout(function() {
                            element.select();
                        }, 50);
                    }
                }
            ");
        }
        await base.OnAfterRenderAsync(firstRender);
    }

    private async Task LoadCustomerData()
    {
        isLoading = true;

        customer = await DatabaseService.GetCustomerAsync(CustomerId);
        if (customer != null)
        {
            transactions = await DatabaseService.GetCustomerTransactionsAsync(CustomerId);
            // Separate deposit transactions
            depositTransactions = transactions.Where(t => t.IsDeposit).ToList();
            // Filter out deposit transactions from main transactions list
            transactions = transactions.Where(t => !t.IsDeposit).ToList();
            GroupTransactions();
        }

        isLoading = false;
    }

    private void GroupTransactions()
    {
        if (transactions == null || transactions.Count == 0)
        {
            groupedTransactions = new List<TransactionGroup>();
            return;
        }

        groupedTransactions = transactions
            .GroupBy(t => t.CurrencyType)
            .Select(g => new TransactionGroup
                {
                    Key = g.Key,
                    Transactions = g.OrderBy(t => t.Date).ToList(),
                    Balance = g.Where(t => t.Type == TransactionType.CustomerDebt).Sum(t => t.Amount) -
                                          g.Where(t => t.Type == TransactionType.StoreDebt).Sum(t => t.Amount)
                })
            .OrderBy(g => g.Key.ToString())
            .ToList();
    }

    private void PrintCustomerReceipt()
    {
        try
        {
            if (!string.IsNullOrEmpty(selectedPrinter))
            {
                // Seçili yazıcıyı PrintService'e bildir
                PrintService.SetPrinterName(selectedPrinter);
            }

            // Yazdır
            PrintService.PrintCustomerReceipt(customer, groupedTransactions);

            // Başarılı mesajı
            Dialog.ShowMessageBox(
                "Yazdırma",
                "Makbuz başarıyla yazdırıldı.",
                yesText: "Tamam");
        }
        catch (Exception ex)
        {
            Dialog.ShowMessageBox(
                "Yazdırma Hatası",
                $"Yazdırma işlemi sırasında bir hata oluştu: {ex.Message}",
                yesText: "Tamam");
        }
    }

    private void GoBack()
    {
        NavigationManager.NavigateTo("/customers");
    }

    private void ShowTransactionModal(TransactionType type, CurrencyType? currencyType = null)
    {
        currentTransaction = new Transaction
            {
                CustomerId = CustomerId,
                Type = type,
                CurrencyType = currencyType ?? CurrencyType.TurkishLira,
                Date = DateTime.Now
            };
        currentTransactionDate = DateTime.Now.Date;
        currentTransactionTime = DateTime.Now.TimeOfDay;
        showTransactionModal = true;
    }

    private void EditTransaction(Transaction transaction)
    {
        currentTransaction = new Transaction
            {
                Id = transaction.Id,
                CustomerId = transaction.CustomerId,
                Amount = transaction.Amount,
                Type = transaction.Type,
                CurrencyType = transaction.CurrencyType,
                Date = transaction.Date,
                Description = transaction.Description,
                IsDeposit = transaction.IsDeposit
            };
        currentTransactionDate = transaction.Date.Date;
        currentTransactionTime = transaction.Date.TimeOfDay;
        showTransactionModal = true;
    }

    private void CloseTransactionModal()
    {
        showTransactionModal = false;
        currentTransaction = new Transaction();
        currentTransactionDate = null;
        currentTransactionTime = null;
    }

    private async Task SaveTransaction()
    {
        if (currentTransactionDate.HasValue && currentTransactionTime.HasValue)
        {
            var dateTime = currentTransactionDate.Value.Date + currentTransactionTime.Value;
            currentTransaction.Date = dateTime;
        }

        // Create transaction summary
        string formattedDate = currentTransaction.Date.ToString("dd.MM.yyyy HH:mm");
        string transactionType = currentTransaction.Type == TransactionType.CustomerDebt ? "Giden" : "Gelen";
        string formattedAmount = Helper.HelperMethods.FormatPrice(currentTransaction.Amount);
        string currencyDisplay = currentTransaction.CurrencyType.GetDisplayName();
        string currencySymbol = currentTransaction.CurrencyType.GetSymbol();

        string summary = $"{formattedDate}\n" +
                        $"{transactionType}";

        if (currentTransaction.Type == TransactionType.StoreDebt && currentTransaction.IsDeposit)
        {
            summary += " (Emanet)";
        }

        summary += $":\n{formattedAmount} {currencySymbol} {currencyDisplay}";

        // Add description to summary if available
        if (!string.IsNullOrWhiteSpace(currentTransaction.Description))
        {
            summary += $"\nAçıklama: {currentTransaction.Description}";
        }

        // Show confirmation dialog
        var confirmResult = await Dialog.ShowMessageBox(
            "Aşağıdaki işlemi kaydetmek istediğinize emin misiniz?",
            $"{summary}",
            yesText: "Evet",
            noText: "Hayır");

        if (confirmResult == true)
        {
            // User confirmed, save the transaction
            await DatabaseService.SaveTransactionAsync(currentTransaction);
            CloseTransactionModal();
            await LoadCustomerData();
        }
    }

    private async Task DeleteTransaction(Transaction transaction)
    {
        string formattedDate = transaction.Date.ToString("dd.MM.yyyy HH:mm");
        string transactionType = transaction.Type == TransactionType.CustomerDebt ? "Giden" : "Gelen";
        string formattedAmount = Helper.HelperMethods.FormatPrice(transaction.Amount);
        string currencyDisplay = transaction.CurrencyType.GetDisplayName();
        string currencySymbol = transaction.CurrencyType.GetSymbol();

        string summary = $"{formattedDate}\n" +
                        $"{transactionType}";

        if (transaction.Type == TransactionType.StoreDebt && transaction.IsDeposit)
        {
            summary += " (Emanet)";
        }

        summary += $":\n{formattedAmount} {currencySymbol} {currencyDisplay}";

        // Show confirmation dialog
        var confirmResult = await Dialog.ShowMessageBox(
            "Aşağıdaki işlemi silmek istediğinize emin misiniz?",
            $"{summary}",
            yesText: "Evet",
            noText: "Hayır");

        if (confirmResult == true)
        {
            await DatabaseService.DeleteTransactionAsync(transaction);
            await LoadCustomerData();
        }
    }

    private async Task SelectInputTextAsync()
    {
        await JSRuntime.InvokeVoidAsync("selectInputText", "amountInput");
    }

    private void ShowTransactionDescription(Transaction transaction)
    {
        Dialog.ShowMessageBox(
            "Açıklama",
            transaction.Description,
            yesText: "Tamam");
    }
}
