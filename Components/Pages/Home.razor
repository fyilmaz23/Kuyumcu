@page "/"
@page "/home"
@using Kuyumcu.Components.Helper
@using Kuyumcu.Models
@using Kuyumcu.Services
@inject DatabaseService DatabaseService
@inject NavigationManager NavigationManager
@inject IDialogService DialogService
@inject IJSRuntime JSRuntime
@inject GoogleDriveService GoogleDriveService

<MudContainer Class="mt-4">
    <MudPaper Elevation="0" Class="mb-4">
        <MudGrid>
            <MudItem xs="12">
                <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center">
                    <MudText Typo="Typo.h4">Kuyumcu Yönetim Paneli</MudText>
                    <MudStack Row="true" Spacing="2">
                        <MudButton Variant="Variant.Filled" Color="Color.Secondary" StartIcon="@Icons.Material.Filled.Backup"
                                   OnClick="@(() => BackupToGoogleDrive())" Disabled="@isBackupInProgress">
                            @(isBackupInProgress ? "Yedekleniyor..." : "Yedek Al")
                        </MudButton>
                        <MudButton Variant="Variant.Filled" Color="Color.Primary" StartIcon="@Icons.Material.Filled.Add"
                                   OnClick="@(() => ShowCustomerModal(new Customer()))">
                            Yeni Müşteri
                        </MudButton>
                        <a class="btn btn-danger d-none" href="/migrate-name">Db Update</a>
                    </MudStack>
                </MudStack>
            </MudItem>
        </MudGrid>
    </MudPaper>

    <MudPaper Elevation="1">
        <MudTabs Elevation="0" Rounded="true" ApplyEffectsToContainer="true" PanelClass="pa-6" ActivePanelIndex="activeIndex" ActivePanelIndexChanged="SetActiveTab">

            <MudTabPanel Text="Müşteriler" Icon="@Icons.Material.Filled.People">
                <MudStack Class="pa-4" Spacing="2">
                    <MudTable T="Customer" ServerData="@ServerReloadCustomers"
                              Dense Hover="true" Breakpoint="Breakpoint.Sm" Loading="@isLoadingCustomers" OnRowClick="RowClickEvent"
                              LoadingProgressColor="Color.Primary" @ref="customerTable">
                        <ToolBarContent>
                            <MudText Typo="Typo.h6">Müşteriler Listesi</MudText>
                            <MudSpacer />
                            <MudTextField T="string" Value="@searchTerm" ValueChanged="@(s => OnCustomerSearch(s))"
                                          Placeholder="İsim veya telefon ara..." Adornment="Adornment.Start"
                                          AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium"
                                          Immediate="true" Class="mt-0"></MudTextField>
                        </ToolBarContent>
                        <HeaderContent>
                            <MudTh><MudTableSortLabel SortLabel="name" T="Customer">İsim</MudTableSortLabel></MudTh>
                            <MudTh><MudTableSortLabel SortLabel="phone" T="Customer">Telefon</MudTableSortLabel></MudTh>
                            <MudTh>İşlemler</MudTh>
                        </HeaderContent>
                        <RowTemplate>
                            <MudTd DataLabel="İsim">@context.Name</MudTd>
                            <MudTd DataLabel="Telefon">@context.PhoneNumber.FormatPhoneNumber()</MudTd>
                            <MudTd DataLabel="İşlemler">
                                <MudStack Row="true">
                                    <MudIconButton Icon="@Icons.Material.Filled.Edit" Color="Color.Primary" Size="Size.Small"
                                                   OnClick="@(() => ShowCustomerModal(context))" />
                                    <MudIconButton Icon="@Icons.Material.Filled.Delete" Color="Color.Error" Size="Size.Small"
                                                   OnClick="@(() => DeleteCustomer(context))" />
                                </MudStack>
                            </MudTd>
                        </RowTemplate>
                        <PagerContent>
                            <MudTablePager RowsPerPageString="Sayfa başına:" InfoFormat="{first_item}-{last_item} / {all_items}" PageSizeOptions="new int[] { 10, 25, 50, 100 }" />
                        </PagerContent>
                    </MudTable>
                </MudStack>
            </MudTabPanel>
            <MudTabPanel Text="Hızlı Kayıt" Icon="@Icons.Material.Filled.Speed">
                <MudGrid Class="pa-4">
                    <MudItem xs="12" md="6">
                        <MudCard>
                            <MudCardHeader>
                                <CardHeaderContent>
                                    <MudText Typo="Typo.h6">@(currentQuickEntry.Id == 0 ? "Yeni Hızlı Kayıt" : "Hızlı Kayıt Düzenle")</MudText>
                                </CardHeaderContent>
                            </MudCardHeader>
                            <MudCardContent>
                                <EditForm Model="@currentQuickEntry" OnValidSubmit="SaveQuickEntryAsync">
                                    <DataAnnotationsValidator />
                                    <MudGrid>
                                        <MudItem xs="12">
                                            <MudTextField @bind-Value="currentQuickEntry.FullName" Label="Ad Soyad"
                                                          Required="true" For="@(() => currentQuickEntry.FullName)" />
                                        </MudItem>
                                        <MudItem xs="12">
                                            <MudTextField T="string" @bind-Value="currentQuickEntry.TcKimlikNo" Label="TC Kimlik No"
                                                          For="@(() => currentQuickEntry.TcKimlikNo)"
                                                          Counter="11" Immediate MaxLength="11" />
                                        </MudItem>
                                        <MudItem xs="12">
                                            <MudNumericField @bind-Value="currentQuickEntry.Tutar" Label="Tutar (₺)"
                                                             Required="true" For="@(() => currentQuickEntry.Tutar)" />
                                        </MudItem>
                                        <MudItem xs="12">
                                            <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled"
                                                       Color="Color.Primary" FullWidth="true">Kaydet</MudButton>
                                        </MudItem>
                                    </MudGrid>
                                </EditForm>
                            </MudCardContent>
                        </MudCard>
                    </MudItem>
                    <MudItem xs="12" md="6">
                        <MudCard>
                            <MudCardHeader>
                                <CardHeaderContent>
                                    <MudText Typo="Typo.h6">Hızlı Kayıtlar</MudText>
                                </CardHeaderContent>
                             @*    <CardHeaderActions>
                                    <MudIconButton Icon="@Icons.Material.Filled.Refresh" Color="Color.Default"
                                                   OnClick="@(async () => await LoadQuickEntries())" />
                                </CardHeaderActions> *@
                            </MudCardHeader>
                            <MudCardContent Style="max-height: 300px; overflow-y: auto;">
                                @if (isLoadingQuickEntries)
                                {
                                    <MudProgressCircular Color="Color.Primary" Indeterminate="true" />
                                }
                                else if (quickEntries == null || quickEntries.Count == 0)
                                {
                                    <MudAlert Severity="Severity.Info">Henüz hızlı kayıt bulunmamaktadır.</MudAlert>
                                }
                                else
                                {
                                    <MudList T="string" Dense="true">
                                        @foreach (var entry in quickEntries)
                                        {
                                            <MudListItem Class="py-2">
                                                <div class="d-flex justify-space-between align-center" style="width: 100%;">
                                                    <div class="mr-2">
                                                        <MudText Typo="Typo.body1"><strong>@entry.FullName</strong></MudText>
                                                        @if (!string.IsNullOrWhiteSpace(entry.TcKimlikNo))
                                                        {
                                                            <MudText Typo="Typo.caption">TC: @entry.TcKimlikNo &nbsp; </MudText>
                                                        }
                                                        <MudText Typo="Typo.caption">@entry.CreatedDate.ToString("dd.MM.yyyy HH:mm")</MudText>
                                                    </div>
                                                    <div class="d-flex align-center">
                                                        <MudText Typo="Typo.h6" Color="Color.Primary" Class="mx-3" Style="min-width: 80px; text-align: right;">
                                                            @entry.Tutar.ToString("C2")
                                                        </MudText>
                                                        <MudIconButton Icon="@Icons.Material.Filled.Edit" Color="Color.Info" Size="Size.Small"
                                                                       OnClick="@(() => EditQuickEntry(entry))" Class="mr-2" />
                                                        <MudIconButton Icon="@Icons.Material.Filled.Delete" Color="Color.Error" Size="Size.Small"
                                                                       OnClick="@(() => DeleteQuickEntryAsync(entry))" Class="mr-2" />
                                                        <MudCheckBox T="bool" Value="@entry.IsProcessed"
                                                                     ValueChanged="@((val) => UpdateProcessedStatus(entry, val))"
                                                                     Color="@(entry.IsProcessed ? Color.Success : Color.Default)"
                                                                     Class="ml-2" />
                                                    </div>
                                                </div>
                                            </MudListItem>
                                            <MudDivider />
                                        }
                                    </MudList>
                                }
                            </MudCardContent>
                            <MudCardActions>
                                <MudPaper Elevation="0" Class="pa-4 d-flex flex-grow-1 gap-4 flex-wrap">
                                    <MudPaper Elevation="2" Class="pa-2 d-flex gap-2 align-center">
                                        <MudIcon Icon="@Icons.Material.Filled.CheckCircle" Color="Color.Success" />
                                        <div>
                                            <MudText Typo="Typo.caption">İşlenenler</MudText>
                                            <MudText Typo="Typo.body1" Color="Color.Success"><strong>@GetProcessedTotalAmount().ToString("C2")</strong></MudText>
                                        </div>
                                    </MudPaper>

                                    <MudPaper Elevation="2" Class="pa-2 d-flex gap-2 align-center">
                                        <MudIcon Icon="@Icons.Material.Filled.Pending" Color="Color.Warning" />
                                        <div>
                                            <MudText Typo="Typo.caption">İşlenmeyenler</MudText>
                                            <MudText Typo="Typo.body1" Color="Color.Warning"><strong>@GetUnprocessedTotalAmount().ToString("C2")</strong></MudText>
                                        </div>
                                    </MudPaper>

                                    <MudPaper Elevation="2" Class="pa-2 d-flex gap-2 align-center">
                                        <MudIcon Icon="@Icons.Material.Filled.Calculate" Color="Color.Primary" />
                                        <div>
                                            <MudText Typo="Typo.caption">Toplam</MudText>
                                            <MudText Typo="Typo.body1" Color="Color.Primary"><strong>@GetTotalAmount().ToString("C2")</strong></MudText>
                                        </div>
                                    </MudPaper>
                                </MudPaper>
                            </MudCardActions>
                        </MudCard>
                    </MudItem>
                </MudGrid>
            </MudTabPanel>


            <MudTabPanel Text="İşlemler" Icon="@Icons.Material.Filled.Receipt">
                <MudStack Class="pa-4" Spacing="2">
                    <MudTable T="Transaction" ServerData="@ServerReloadTransactions"
                              Dense="true" Hover="true" Breakpoint="Breakpoint.Sm" Loading="@isLoadingTransactions"
                              LoadingProgressColor="Color.Primary" @ref="transactionTable">
                        <ToolBarContent>
                            <MudText Typo="Typo.h6">İşlemler Listesi</MudText>
                        </ToolBarContent>
                        <HeaderContent>
                            <MudTh><MudTableSortLabel SortLabel="date" T="Transaction" InitialDirection="MudBlazor.SortDirection.Descending">Tarih</MudTableSortLabel></MudTh>
                            <MudTh>Müşteri</MudTh>
                            <MudTh><MudTableSortLabel SortLabel="type" T="Transaction">Tür</MudTableSortLabel></MudTh>
                            <MudTh><MudTableSortLabel SortLabel="amount" T="Transaction">Miktar</MudTableSortLabel></MudTh>
                            <MudTh><MudTableSortLabel SortLabel="currencyType" T="Transaction">Para Birimi</MudTableSortLabel></MudTh>
                            <MudTh>Açıklama</MudTh>
                        </HeaderContent>
                        <RowTemplate>
                            <MudTd DataLabel="Tarih">@context.Date.ToString("dd.MM.yyyy HH:mm")</MudTd>
                            <MudTd DataLabel="Müşteri">
                                <MudLink Href="@($"/customer/{context.CustomerId}")">
                                    @GetCustomerName(context.CustomerId)
                                </MudLink>
                            </MudTd>
                            <MudTd DataLabel="Tür">
                                @if (context.Type == TransactionType.CustomerDebt)
                                {
                                    <MudChip T="string" Color="Color.Error" Size="Size.Small" Text="Giden" />
                                }
                                else
                                {
                                    <MudChip T="string" Color="Color.Success" Size="Size.Small" Text="Gelen" />
                                }
                            </MudTd>
                            <MudTd DataLabel="Miktar">@Helper.HelperMethods.FormatPrice(context.Amount)</MudTd>
                            <MudTd DataLabel="Para Birimi">@GetCurrencyName(context.CurrencyType)</MudTd>
                            <MudTd DataLabel="Açıklama">@context.Description</MudTd>
                        </RowTemplate>
                        <PagerContent>
                            <MudTablePager RowsPerPageString="Sayfa başına:" InfoFormat="{first_item}-{last_item} / {all_items}" PageSizeOptions="new int[] { 10, 25, 50, 100 }" />
                        </PagerContent>
                    </MudTable>
                </MudStack>
            </MudTabPanel>
        </MudTabs>
    </MudPaper>
</MudContainer>

<MudDialog @bind-Visible="showCustomerModal">
    <DialogContent>
        <MudContainer Style="max-height: 500px; overflow-y: auto">
            <MudText Typo="Typo.h6" Class="mb-4">@(currentCustomer.Id == 0 ? "Yeni Müşteri" : "Müşteri Düzenle")</MudText>
            <EditForm Model="@currentCustomer" OnValidSubmit="SaveCustomer">
                <DataAnnotationsValidator />
                <MudGrid>
                    <MudItem xs="12">
                        <MudTextField @bind-Value="currentCustomer.Name" Label="Müşteri Adı" Variant="Variant.Outlined"
                                      Required="true" RequiredError="Müşteri adı gereklidir" />
                        <ValidationMessage For="@(() => currentCustomer.Name)" />
                    </MudItem>
                    <MudItem xs="12">

                        <MudTextField @bind-Value="currentCustomer.PhoneNumber" Mask=@mask2 Label="Telefon"
                                      Variant="Variant.Outlined" Immediate MaxLength="10" />
                        <ValidationMessage For="@(() => currentCustomer.PhoneNumber)" />
                    </MudItem>
                </MudGrid>
                <MudDivider Class="my-4" />
                <MudStack Row="true" Justify="Justify.FlexEnd">
                    <MudButton Variant="Variant.Text" Color="Color.Default" OnClick="CloseCustomerModal">İptal</MudButton>
                    <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary">Kaydet</MudButton>
                </MudStack>
            </EditForm>
        </MudContainer>
    </DialogContent>
</MudDialog>
@code {
    private bool showCustomerModal;
    private bool isBackupInProgress = false;
    private string backupResult = string.Empty;
    int activeIndex = 0;

    public PatternMask mask2 = new PatternMask("XXX-XXX-XX-XX")
        {
            MaskChars = new[] { new MaskChar('X', @"[0-9]") },
            Placeholder = '_',
            CleanDelimiters = true,
        };

    // Active tab

    // QuickEntry related properties
    private List<QuickEntry> quickEntries;
    private QuickEntry currentQuickEntry = new QuickEntry();
    private bool isLoadingQuickEntries = false;

    // Customers variables
    private List<Customer> customers;
    private List<Customer> filteredCustomers;
    private string searchTerm = "";
    private bool isLoadingCustomers = false;
    private Customer currentCustomer = new Customer();
    private MudTable<Customer> customerTable;

    // Transactions variables
    private List<Transaction> transactions;
    private string transactionSearchTerm = "";
    private bool isLoadingTransactions = false;
    private MudTable<Transaction> transactionTable;
    private Dictionary<int, string> transactionCustomerNames = new Dictionary<int, string>();

    protected override async Task OnInitializedAsync()
    {
        await LoadCustomers();
        if (activeIndex == 1)
            await LoadQuickEntries();
        else if (activeIndex == 2)
            await LoadTransactions();
    }
    private async Task SetActiveTab(int index)
    {
        activeIndex = index;
        if (activeIndex == 0)
            await LoadCustomers();
        else if (activeIndex == 1)
            await LoadQuickEntries();
        else if (activeIndex == 2)
            await LoadTransactions();
    }

    // Server-side pagination for customers
    private async Task<TableData<Customer>> ServerReloadCustomers(TableState state, CancellationToken cancellationToken)
    {
        try
        {

            var customers = await DatabaseService.GetCustomersPaginationAsync(state.Page, state.PageSize, state?.SortLabel, Helper.HelperMethods.GetSortDirection(state?.SortDirection), searchTerm);
            int totalItems = await DatabaseService.GetCustomerCountAsync(searchTerm);

            // Update balances for customers if necessary
            return new TableData<Customer>
            {
                Items = customers,
                TotalItems = totalItems
            };
        }
        catch (Exception ex)
        {
            Console.WriteLine(ex);
            // Handle errors
            return new TableData<Customer>
            {
                Items = new List<Customer>(),
                TotalItems = 0
            };
        }
    }

    private async Task OnCustomerSearch(string text)
    {
        searchTerm = text;
        await customerTable.ReloadServerData();
    }

    // QuickEntry methods
    private async Task LoadQuickEntries()
    {
        isLoadingQuickEntries = true;
        try
        {
            quickEntries = await DatabaseService.GetQuickEntriesAsync();
        }
        finally
        {
            isLoadingQuickEntries = false;
            StateHasChanged();
        }
    }

    private async Task SaveQuickEntryAsync()
    {
        if (currentQuickEntry.Id != 0)
        {
            // Düzenleme işlemi - CreatedDate'i koruyoruz
            var existingEntry = await DatabaseService.GetQuickEntryAsync(currentQuickEntry.Id);
            currentQuickEntry.CreatedDate = existingEntry.CreatedDate;
        }
        else
        {
            // Yeni kayıt - CreatedDate'i şu anki zaman olarak ayarlıyoruz
            currentQuickEntry.CreatedDate = DateTime.Now;
        }

        await DatabaseService.SaveQuickEntryAsync(currentQuickEntry);
        await LoadQuickEntries();

        // Form'u temizle
        ResetQuickEntryForm();
    }

    private void ResetQuickEntryForm()
    {
        currentQuickEntry = new QuickEntry
            {
                Id = 0
            };
    }

    private async Task DeleteQuickEntryAsync(QuickEntry entry)
    {
        bool? result = await DialogService.ShowMessageBox(
            "Silme Onayı",
            "Bu kaydı silmek istediğinize emin misiniz?",
            yesText: "Evet", cancelText: "Hayır");

        if (result == true)
        {
            await DatabaseService.DeleteQuickEntryAsync(entry);
            await LoadQuickEntries();
        }
    }

    private async Task EditQuickEntry(QuickEntry entry)
    {
        // Düzenlenecek kaydın bilgilerini forma yükle
        currentQuickEntry = new QuickEntry
            {
                Id = entry.Id,
                FullName = entry.FullName,
                TcKimlikNo = entry.TcKimlikNo,
                Tutar = entry.Tutar,
                IsProcessed = entry.IsProcessed,
                CreatedDate = entry.CreatedDate
            };

        // Formun bulunduğu konuma kaydır
        await JSRuntime.InvokeVoidAsync("scrollToTop");
    }

    private async Task UpdateProcessedStatus(QuickEntry entry, bool value)
    {
        entry.IsProcessed = value;
        await DatabaseService.UpdateQuickEntryAsync(entry);
    }

    // Customer methods
    private async Task LoadCustomers()
    {
        isLoadingCustomers = true;
        
        
        // Sayfalama kullanıldığı için müşteri listesinin 
        // tamamını burada yüklemeye gerek yok, 
        // sadece customerTable.ReloadServerData() çağırıyoruz
        if (customerTable != null)
        {
            await customerTable.ReloadServerData();
        }
        
        isLoadingCustomers = false;
    }

    private void Search()
    {
        // Legacy method, server-side filtering ile değişti
        if (customerTable != null)
        {
            customerTable.ReloadServerData();
        }
    }


    private void ShowCustomerModal(Customer customer)
    {
        currentCustomer = new Customer
            {
                Id = customer.Id,
                Name = customer.Name,
                PhoneNumber = customer.PhoneNumber
            };
        showCustomerModal = true;
    }

    private void CloseCustomerModal()
    {
        showCustomerModal = false;
    }

    private async Task SaveCustomer()
    {
        // Yeni müşteri ekliyorsak aynı isimde başka müşteri var mı kontrol et
        if (currentCustomer.Id == 0 && !string.IsNullOrWhiteSpace(currentCustomer.Name))
        {
            var existingCustomer = await DatabaseService.GetCustomerByNameAsync(currentCustomer.Name);
            if (existingCustomer != null)
            {
                // Varolan müşteri bulundu, uyarı göster
                bool? result = await DialogService.ShowMessageBox(
                    "Aynı İsimde Müşteri Bulundu",
                    $"\"{currentCustomer.Name}\" adında bir müşteri zaten var. Ne yapmak istersiniz?",
                    yesText: "Varolan Müşteriye Git",
                    noText: "Yine de Kaydet",
                    cancelText: "İptal");

                if (result == true) // Varolan müşteriye git
                {
                    CloseCustomerModal();
                    NavigationManager.NavigateTo($"/customer/{existingCustomer.Id}");
                    return;
                }
                else if (result == null) // İptal
                {
                    return;
                }
                // Else: Yine de kaydet - devam et
            }
        }
        await DatabaseService.SaveCustomerAsync(currentCustomer);
        showCustomerModal = false;
        await LoadCustomers();
        NavigateToCustomerDetail(currentCustomer.Id);
    }

    private void EditCustomer(Customer customer)
    {
        currentCustomer = new Customer
            {
                Id = customer.Id,
                Name = customer.Name,
                PhoneNumber = customer.PhoneNumber
            };
        showCustomerModal = true;
    }

    private async Task DeleteCustomer(Customer customer)
    {
        bool? result = await DialogService.ShowMessageBox(
            "Silme Onayı",
            $"{customer.Name} isimli müşteriyi silmek istediğinize emin misiniz?",
            yesText: "Evet", cancelText: "Hayır");

        if (result == true)
        {
            await DatabaseService.DeleteCustomerAsync(customer);
            await LoadCustomers();
        }
    }

    private void NavigateToCustomerDetail(int customerId)
    {
        NavigationManager.NavigateTo($"/customer/{customerId}");
    }

    private async Task LoadTransactions()
    {
        isLoadingTransactions = true;
        transactions = await DatabaseService.GetTransactionsAsync();
        transactions = transactions.Where(t => !t.IsDeposit).ToList();
        isLoadingTransactions = false;
    }

    private async Task<TableData<Transaction>> ServerReloadTransactions(TableState state, CancellationToken cancellationToken)
    {
        try
        {
            var transactions = await DatabaseService.GetTransactionsPaginationAsync(state.Page, state.PageSize, state?.SortLabel, Helper.HelperMethods.GetSortDirection(state?.SortDirection), transactionSearchTerm);
            transactions = transactions.Where(t => !t.IsDeposit).ToList();
            int totalItems = await DatabaseService.GetTransactionCountAsync(transactionSearchTerm);

            // Müşteri adlarını yükleyelim
            foreach (var transaction in transactions)
            {
                if (transaction.CustomerId > 0 && !transactionCustomerNames.ContainsKey(transaction.CustomerId))
                {
                    var customer = await DatabaseService.GetCustomerAsync(transaction.CustomerId);
                    if (customer != null)
                    {
                        transactionCustomerNames[transaction.CustomerId] = customer.Name;
                    }
                }
            }

            return new TableData<Transaction>
            {
                Items = transactions,
                TotalItems = totalItems
            };
        }
        catch (Exception ex)
        {
            Console.WriteLine(ex);
            // Handle errors
            return new TableData<Transaction>
            {
                Items = new List<Transaction>(),
                TotalItems = 0
            };
        }
    }

    private async Task OnTransactionSearch(string text)
    {
        transactionSearchTerm = text;
        await transactionTable.ReloadServerData();
    }

    private void RowClickEvent(TableRowClickEventArgs<Customer> customer)
    {
        if (customer?.Item != null)
            NavigationManager.NavigateTo($"/customer/{customer.Item.Id}");

    }

    private string GetCustomerName(int customerId)
    {
        // Önce transactionCustomerNames sözlüğünde var mı diye kontrol edelim
        if (transactionCustomerNames.ContainsKey(customerId))
        {
            return transactionCustomerNames[customerId];
        }
        
        // Sözlükte yoksa customers listesinde arayalım
        return customers?.FirstOrDefault(c => c.Id == customerId)?.Name ?? "Bilinmeyen Müşteri";
    }

    private string GetCurrencyName(CurrencyType currencyType)
    {
        return currencyType.GetDisplayName();
    }

    private decimal GetProcessedTotalAmount()
    {
        return quickEntries?.Where(e => e.IsProcessed).Sum(e => e.Tutar) ?? 0;
    }

    private decimal GetUnprocessedTotalAmount()
    {
        return quickEntries?.Where(e => !e.IsProcessed).Sum(e => e.Tutar) ?? 0;
    }

    private decimal GetTotalAmount()
    {
        return quickEntries?.Sum(e => e.Tutar) ?? 0;
    }

    private async Task BackupToGoogleDrive()
    {
        try
        {
            isBackupInProgress = true;
            StateHasChanged();

            backupResult = await GoogleDriveService.BackupDatabaseAsync();

            await DialogService.ShowMessageBox(
                "Yedekleme",
                backupResult,
                yesText: "Tamam");
        }
        catch (Exception ex)
        {
            await DialogService.ShowMessageBox(
                "Hata",
                $"Yedekleme sırasında bir hata oluştu: {ex.Message}",
                yesText: "Tamam");
        }
        finally
        {
            isBackupInProgress = false;
            StateHasChanged();
        }
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await JSRuntime.InvokeVoidAsync("eval", @"
                window.scrollToTop = function() {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            ");
        }
    }
}
